{% doc %}
  @prompt
    Create a collapsible row block for the product information section that appears in the Add block menu. The block must include: 1) A collapsible accordion with clickable heading that expands/collapses content, 2) A page picker setting so merchants can select any page (like a size chart page) to display the content, 3) A text input for the collapsible heading title, 4) Proper schema with @app target so it appears in the Add block section, 5) Dawn theme styling with smooth animations. The block should render the selected page content inside the collapsible area when expanded.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-collapsible-row-{{ ai_gen_id }} {
    border-top: 1px solid rgba(0, 0, 0, 0.08);
  }

  .ai-collapsible-row-{{ ai_gen_id }}:last-child {
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }

  .ai-collapsible-row-header-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 16px 0;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    font-family: inherit;
    color: inherit;
  }

  .ai-collapsible-row-header-{{ ai_gen_id }}:hover {
    opacity: 0.7;
  }

  .ai-collapsible-row-title-{{ ai_gen_id }} {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .ai-collapsible-row-icon-{{ ai_gen_id }} {
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }

  .ai-collapsible-row-icon-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    stroke: currentColor;
    stroke-width: 1.5;
  }

  .ai-collapsible-row-header-{{ ai_gen_id }}[aria-expanded="true"] .ai-collapsible-row-icon-{{ ai_gen_id }} {
    transform: rotate(180deg);
  }

  .ai-collapsible-row-content-{{ ai_gen_id }} {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    opacity: 0;
  }

  .ai-collapsible-row-content-{{ ai_gen_id }}.active {
    max-height: 2000px;
    opacity: 1;
    padding-bottom: 16px;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} {
    font-size: 14px;
    line-height: 1.6;
    color: rgba(0, 0, 0, 0.7);
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} p {
    margin: 0 0 12px;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} p:last-child {
    margin-bottom: 0;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} ul,
  .ai-collapsible-row-inner-{{ ai_gen_id }} ol {
    margin: 0 0 12px;
    padding-left: 20px;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} li {
    margin-bottom: 8px;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} a {
    color: inherit;
    text-decoration: underline;
  }

  .ai-collapsible-row-inner-{{ ai_gen_id }} a:hover {
    opacity: 0.7;
  }
{% endstyle %}

<collapsible-row-{{ ai_gen_id }} class="ai-collapsible-row-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <button
    class="ai-collapsible-row-header-{{ ai_gen_id }}"
    aria-expanded="false"
    aria-controls="ai-collapsible-content-{{ ai_gen_id }}"
  >
    <h3 class="ai-collapsible-row-title-{{ ai_gen_id }}">
      {{ block.settings.heading }}
    </h3>
    <span class="ai-collapsible-row-icon-{{ ai_gen_id }}">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </span>
  </button>

  <div
    class="ai-collapsible-row-content-{{ ai_gen_id }}"
    id="ai-collapsible-content-{{ ai_gen_id }}"
  >
    <div class="ai-collapsible-row-inner-{{ ai_gen_id }}">
      {% if block.settings.page != blank %}
        {{ block.settings.page.content }}
      {% else %}
        <p style="color: #999; font-style: italic;">Select a page to display content here</p>
      {% endif %}
    </div>
  </div>
</collapsible-row-{{ ai_gen_id }}>

<script>
  (function() {
    class CollapsibleRow{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.button = this.querySelector('.ai-collapsible-row-header-{{ ai_gen_id }}');
        this.content = this.querySelector('.ai-collapsible-row-content-{{ ai_gen_id }}');

        if (this.button && this.content) {
          this.button.addEventListener('click', this.toggle.bind(this));
        }
      }

      toggle() {
        const isExpanded = this.button.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
          this.close();
        } else {
          this.open();
        }
      }

      open() {
        this.button.setAttribute('aria-expanded', 'true');
        this.content.classList.add('active');
      }

      close() {
        this.button.setAttribute('aria-expanded', 'false');
        this.content.classList.remove('active');
      }
    }

    customElements.define('collapsible-row-{{ ai_gen_id }}', CollapsibleRow{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Collapsible row",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Collapsible row"
    },
    {
      "type": "page",
      "id": "page",
      "label": "Page"
    }
  ],
  "presets": [
    {
      "name": "Collapsible row"
    }
  ]
}
{% endschema %}
