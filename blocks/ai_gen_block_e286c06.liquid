{% doc %}
  @prompt
    Create a visually attractive product carousel section that dynamically displays products from a collection. Include:
    - A collection picker setting to select which collection to display
    - Loop through collection.products using Liquid
    - For each product show: product.featured_image, product title, product price, and attractive star rating/review display
    - Product cards with NO border radius (sharp corners, border-radius: 0)
    - A plus icon that appears in the bottom corner of the product image ONLY on hover
    - Modern, clean design with smooth horizontal scrolling carousel
    - Responsive layout that looks good on all devices
    - Hover effects on product cards
    - Proper spacing and typography
    Use proper Liquid syntax to fetch real product data including images, titles, and prices from the selected collection. Make sure cards have sharp edges with no rounded corners.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-carousel-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-product-carousel-container-{{ ai_gen_id }} {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-product-carousel-header-{{ ai_gen_id }} {
    text-align: {{ block.settings.heading_alignment }};
    margin-bottom: 40px;
  }

  .ai-product-carousel-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0;
    text-transform: {{ block.settings.heading_text_transform }};
  }

  .ai-product-carousel-wrapper-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
  }

  .ai-product-carousel-track-{{ ai_gen_id }} {
    display: flex;
    gap: {{ block.settings.card_gap }}px;
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: 20px;
  }

  .ai-product-carousel-track-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-product-card-{{ ai_gen_id }} {
    flex: 0 0 auto;
    width: {{ block.settings.card_width_desktop }}px;
    background-color: {{ block.settings.card_background }};
    border: {{ block.settings.card_border_width }}px solid {{ block.settings.card_border_color }};
    border-radius: 0;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }

  .ai-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-{{ block.settings.hover_lift }}px);
    box-shadow: 0 {{ block.settings.hover_shadow_size }}px {{ block.settings.hover_shadow_size | times: 2 }}px rgba(0, 0, 0, {{ block.settings.hover_shadow_opacity | divided_by: 100.0 }});
  }

  .ai-product-card-link-{{ ai_gen_id }} {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .ai-product-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    overflow: hidden;
    background-color: {{ block.settings.image_background }};
  }

  .ai-product-image-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .ai-product-card-{{ ai_gen_id }}:hover .ai-product-image-{{ ai_gen_id }} {
    transform: scale(1.05);
  }

  .ai-product-plus-icon-{{ ai_gen_id }} {
    position: absolute;
    bottom: 15px;
    right: 15px;
    width: 40px;
    height: 40px;
    background-color: {{ block.settings.plus_icon_background }};
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none;
  }

  .ai-product-card-{{ ai_gen_id }}:hover .ai-product-plus-icon-{{ ai_gen_id }} {
    opacity: 1;
    transform: scale(1);
  }

  .ai-product-plus-icon-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    stroke: {{ block.settings.plus_icon_color }};
    stroke-width: 2;
  }

  .ai-product-info-{{ ai_gen_id }} {
    padding: 20px;
  }

  .ai-product-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_title_size }}px;
    color: {{ block.settings.product_title_color }};
    margin: 0 0 10px;
    font-weight: 600;
    line-height: 1.3;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .ai-product-rating-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
  }

  .ai-product-stars-{{ ai_gen_id }} {
    display: flex;
    gap: 2px;
  }

  .ai-product-star-{{ ai_gen_id }} {
    width: 16px;
    height: 16px;
  }

  .ai-product-star-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    fill: {{ block.settings.star_color }};
  }

  .ai-product-star-empty-{{ ai_gen_id }} svg {
    fill: {{ block.settings.star_empty_color }};
  }

  .ai-product-rating-count-{{ ai_gen_id }} {
    font-size: 12px;
    color: {{ block.settings.rating_text_color }};
  }

  .ai-product-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_price_size }}px;
    color: {{ block.settings.product_price_color }};
    font-weight: 600;
  }

  .ai-product-compare-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_price_size | minus: 2 }}px;
    color: {{ block.settings.compare_price_color }};
    text-decoration: line-through;
    margin-left: 8px;
  }

  .ai-carousel-nav-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
  }

  .ai-carousel-nav-button-{{ ai_gen_id }} {
    width: 50px;
    height: 50px;
    border: 1px solid {{ block.settings.nav_button_border }};
    background-color: {{ block.settings.nav_button_background }};
    border-radius: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .ai-carousel-nav-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.nav_button_hover_background }};
    border-color: {{ block.settings.nav_button_hover_border }};
  }

  .ai-carousel-nav-button-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    stroke: {{ block.settings.nav_button_icon }};
    stroke-width: 2;
  }

  .ai-carousel-nav-button-{{ ai_gen_id }}:hover svg {
    stroke: {{ block.settings.nav_button_hover_icon }};
  }

  .ai-empty-state-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }

  .ai-empty-state-{{ ai_gen_id }} p {
    font-size: 16px;
    margin: 10px 0 0;
  }

  @media screen and (max-width: 989px) {
    .ai-product-card-{{ ai_gen_id }} {
      width: {{ block.settings.card_width_tablet }}px;
    }

    .ai-product-carousel-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }
  }

  @media screen and (max-width: 749px) {
    .ai-product-card-{{ ai_gen_id }} {
      width: {{ block.settings.card_width_mobile }}px;
    }

    .ai-product-carousel-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.6 }}px;
    }

    .ai-product-carousel-container-{{ ai_gen_id }} {
      padding: 0 15px;
    }

    .ai-product-info-{{ ai_gen_id }} {
      padding: 15px;
    }

    .ai-product-plus-icon-{{ ai_gen_id }} {
      width: 35px;
      height: 35px;
      bottom: 10px;
      right: 10px;
    }

    .ai-product-plus-icon-{{ ai_gen_id }} svg {
      width: 16px;
      height: 16px;
    }
  }



  /* Judge.me star rating styling for carousel */
.jdgm-widget {
  margin: 10px 0;
  text-align: center;
  min-height: 20px;
}

.jdgm-preview-badge {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 5px;
}

.jdgm-preview-badge .jdgm-star {
  font-size: 16px;
}

.jdgm-preview-badge .jdgm-rev-widg__summary-text {
  font-size: 13px;
  color: #666;
  margin-left: 5px;
}

/* Ensure stars are visible on your premium design */
.carousel-product-card .jdgm-widget {
  padding: 8px 0;
}

.ai-price-compare-{{ ai_gen_id }} {
  text-decoration: line-through;
  opacity: 0.7;
  margin-left: 6px;
}


.carousel-container {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 1rem;
}

.carousel-card {
  flex: 0 0 auto;
  width: 100%;
  max-width: 300px;
}

@media (min-width: 768px) {
  .carousel-card {
    width: calc(50% - 0.5rem);
  }
}

@media (min-width: 1024px) {
  .carousel-card {
    width: calc(33.333% - 0.67rem);
  }
}



{% endstyle %}

<product-carousel-{{ ai_gen_id }} class="ai-product-carousel-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-product-carousel-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <div class="ai-product-carousel-header-{{ ai_gen_id }}">
        <h2 class="ai-product-carousel-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      </div>
    {% endif %}

    {% if block.settings.collection != blank and block.settings.collection.products.size > 0 %}
      <div class="ai-product-carousel-wrapper-{{ ai_gen_id }}">
        <div class="ai-product-carousel-track-{{ ai_gen_id }}" data-carousel-track>
          {% for product in block.settings.collection.products limit: block.settings.products_to_show %}
            <div class="ai-product-card-{{ ai_gen_id }}">
              <a href="{{ product.url }}" class="ai-product-card-link-{{ ai_gen_id }}">
                <div class="ai-product-image-wrapper-{{ ai_gen_id }}">
                  {% if product.featured_image %}
                    <img
                      src="{{ product.featured_image | image_url: width: 600 }}"
                      alt="{{ product.featured_image.alt | escape }}"
                      class="ai-product-image-{{ ai_gen_id }}"
                      loading="lazy"
                      width="600"
                      height="600"
                    >
                  {% else %}
                    <div class="ai-product-image-placeholder-{{ ai_gen_id }}">
                      {{ 'product-1' | placeholder_svg_tag }}
                    </div>
                  {% endif %}
                  <div class="ai-product-plus-icon-{{ ai_gen_id }}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </div>
                </div>

                <div class="ai-product-info-{{ ai_gen_id }}">
                  <h3 class="ai-product-title-{{ ai_gen_id }}">{{ product.title }}</h3>
<!-- Judge.me Star Rating Widget -->
<div class="jdgm-widget jdgm-preview-badge" data-id="{{ product.id }}">
  {{ product.metafields.judgeme.badge }}
</div>


                 {% assign current_variant = product.selected_or_first_available_variant %}

<div class="ai-product-price-{{ ai_gen_id }}">
  {% if current_variant.compare_at_price > current_variant.price %}
    <span class="ai-price-sale-{{ ai_gen_id }}">{{ current_variant.price | money }}</span>
    <span class="ai-price-compare-{{ ai_gen_id }}">{{ current_variant.compare_at_price | money }}</span>
  {% else %}
    <span class="ai-price-regular-{{ ai_gen_id }}">{{ current_variant.price | money }}</span>
  {% endif %}
</div>


                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>

      {% if block.settings.show_navigation %}
        <div class="ai-carousel-nav-{{ ai_gen_id }}">
          <button class="ai-carousel-nav-button-{{ ai_gen_id }}" data-carousel-prev aria-label="Previous">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="ai-carousel-nav-button-{{ ai_gen_id }}" data-carousel-next aria-label="Next">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      {% endif %}
    {% else %}
      <div class="ai-empty-state-{{ ai_gen_id }}">
        {{ 'collection-1' | placeholder_svg_tag }}
        <p>Select a collection to display products</p>
      </div>
    {% endif %}
  </div>
</product-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class ProductCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.track = this.querySelector('[data-carousel-track]');
        this.prevButton = this.querySelector('[data-carousel-prev]');
        this.nextButton = this.querySelector('[data-carousel-next]');
      }

      connectedCallback() {
        if (!this.track) return;

        this.setupNavigation();
        this.setupTouchScroll();
      }

      setupNavigation() {
        if (!this.prevButton || !this.nextButton) return;

        this.prevButton.addEventListener('click', () => {
         // Find the click event handlers for next/previous buttons
// Replace the scroll logic with something like this:

const scrollAmount = carousel.querySelector('.card').offsetWidth + gap;
carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });

        });

        this.nextButton.addEventListener('click', () => {
          // Find the click event handlers for next/previous buttons
// Replace the scroll logic with something like this:

const scrollAmount = carousel.querySelector('.card').offsetWidth + gap;
carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });

        });
      }

      setupTouchScroll() {
        let isDown = false;
        let startX;
        let scrollLeft;

        this.track.addEventListener('mousedown', (e) => {
          isDown = true;
          this.track.style.cursor = 'grabbing';
          startX = e.pageX - this.track.offsetLeft;
          scrollLeft = this.track.scrollLeft;
        });

        this.track.addEventListener('mouseleave', () => {
          isDown = false;
          this.track.style.cursor = 'grab';
        });

        this.track.addEventListener('mouseup', () => {
          isDown = false;
          this.track.style.cursor = 'grab';
        });

        this.track.addEventListener('mousemove', (e) => {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - this.track.offsetLeft;
          const walk = (x - startX) * 2;
          this.track.scrollLeft = scrollLeft - walk;
        });
      }
    }

    customElements.define('product-carousel-{{ ai_gen_id }}', ProductCarousel{{ ai_gen_id }});
  })();
</script>


<script>
  if (typeof JudgeMe !== 'undefined') {
    JudgeMe.init();
  }
</script>


{% schema %}
{
  "name": "Product carousel",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Collection"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 20,
      "step": 1,
      "label": "Products to show",
      "default": 12
    },
    {
      "type": "header",
      "content": "Heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 48
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "heading_text_transform",
      "label": "Heading text transform",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "uppercase",
          "label": "Uppercase"
        }
      ],
      "default": "uppercase"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "range",
      "id": "card_width_desktop",
      "min": 200,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Card width (desktop)",
      "default": 300
    },
    {
      "type": "range",
      "id": "card_width_tablet",
      "min": 150,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Card width (tablet)",
      "default": 250
    },
    {
      "type": "range",
      "id": "card_width_mobile",
      "min": 150,
      "max": 280,
      "step": 10,
      "unit": "px",
      "label": "Card width (mobile)",
      "default": 220
    },
    {
      "type": "range",
      "id": "card_gap",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Gap between cards",
      "default": 20
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Card border width",
      "default": 1
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card border color",
      "default": "#e6e6e6"
    },
    {
      "type": "header",
      "content": "Hover effects"
    },
    {
      "type": "range",
      "id": "hover_lift",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Hover lift",
      "default": 8
    },
    {
      "type": "range",
      "id": "hover_shadow_size",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Hover shadow size",
      "default": 10
    },
    {
      "type": "range",
      "id": "hover_shadow_opacity",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "%",
      "label": "Hover shadow opacity",
      "default": 15
    },
    {
      "type": "header",
      "content": "Plus icon"
    },
    {
      "type": "color",
      "id": "plus_icon_background",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "plus_icon_color",
      "label": "Icon color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Product details"
    },
    {
      "type": "range",
      "id": "product_title_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 16
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "product_price_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Price size",
      "default": 18
    },
    {
      "type": "color",
      "id": "product_price_color",
      "label": "Price color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "compare_price_color",
      "label": "Compare price color",
      "default": "#999999"
    },
    {
      "type": "header",
      "content": "Rating"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating",
      "default": true
    },
    {
      "type": "range",
      "id": "default_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Default rating",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_review_count",
      "label": "Show review count",
      "default": true
    },
    {
      "type": "range",
      "id": "default_review_count",
      "min": 0,
      "max": 500,
      "step": 5,
      "label": "Default review count",
      "default": 25
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star color",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "star_empty_color",
      "label": "Empty star color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "rating_text_color",
      "label": "Rating text color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show navigation buttons",
      "default": true
    },
    {
      "type": "color",
      "id": "nav_button_background",
      "label": "Button background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "nav_button_border",
      "label": "Button border",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_button_icon",
      "label": "Icon color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_button_hover_background",
      "label": "Hover background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_button_hover_border",
      "label": "Hover border",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_button_hover_icon",
      "label": "Hover icon color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Section style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "image_background",
      "label": "Image background",
      "default": "#f5f5f5"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Product carousel"
    }
  ]
}
{% endschema %}
