{% doc %}
  @prompt
    Create a mega menu block that displays two images on the right side of the header dropdown when hovering over collection links. Each collection link (Clothing, Baby Cloth, Home Page, etc.) should have its own set of two images that appear on hover. The menu should have a split layout: navigation links on the left, and a dedicated image area on the right that updates based on which link is being hovered. Include settings to assign two specific images per collection link with smooth fade transitions between hovers. Images should be configurable in the theme editor for each menu item.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-mega-menu-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    position: relative;
  }

  .ai-mega-menu-container-{{ ai_gen_id }} {
    display: flex;
    gap: {{ block.settings.gap }}px;
    padding: {{ block.settings.padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
  }

  .ai-mega-menu-nav-{{ ai_gen_id }} {
    flex: 0 0 {{ block.settings.nav_width }}%;
    display: flex;
    flex-direction: column;
    gap: {{ block.settings.link_spacing }}px;
  }

  .ai-mega-menu-link-{{ ai_gen_id }} {
    padding: {{ block.settings.link_padding }}px;
    color: {{ block.settings.link_color }};
    text-decoration: none;
    font-size: {{ block.settings.link_font_size }}px;
    border-radius: {{ block.settings.link_border_radius }}px;
    transition: all {{ block.settings.transition_speed }}s ease;
    cursor: pointer;
    background-color: transparent;
  }

  .ai-mega-menu-link-{{ ai_gen_id }}:hover,
  .ai-mega-menu-link-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.link_hover_bg }};
    color: {{ block.settings.link_hover_color }};
  }

  .ai-mega-menu-images-{{ ai_gen_id }} {
    flex: 1;
    position: relative;
    min-height: {{ block.settings.image_height }}px;
    border-radius: {{ block.settings.image_border_radius }}px;
    overflow: hidden;
  }

  .ai-mega-menu-image-set-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: {{ block.settings.image_gap }}px;
    opacity: 0;
    visibility: hidden;
    transition: opacity {{ block.settings.transition_speed }}s ease, visibility {{ block.settings.transition_speed }}s ease;
  }

  .ai-mega-menu-image-set-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  .ai-mega-menu-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: {{ block.settings.image_border_radius }}px;
  }

  .ai-mega-menu-image-wrapper-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-mega-menu-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-mega-menu-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }

  .ai-mega-menu-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 4px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  @media screen and (max-width: 749px) {
    .ai-mega-menu-container-{{ ai_gen_id }} {
      flex-direction: column;
    }

    .ai-mega-menu-nav-{{ ai_gen_id }} {
      flex: 1;
    }

    .ai-mega-menu-images-{{ ai_gen_id }} {
      min-height: {{ block.settings.mobile_image_height }}px;
    }
  }
{% endstyle %}

<mega-menu-{{ ai_gen_id }} class="ai-mega-menu-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-mega-menu-container-{{ ai_gen_id }}">
    <nav class="ai-mega-menu-nav-{{ ai_gen_id }}">
      {% for i in (1..6) %}
        {% liquid
          assign link_enabled_key = 'link_' | append: i | append: '_enabled'
          assign link_text_key = 'link_' | append: i | append: '_text'
          assign link_url_key = 'link_' | append: i | append: '_url'

          assign link_enabled = block.settings[link_enabled_key]
          assign link_text = block.settings[link_text_key]
          assign link_url = block.settings[link_url_key]
        %}

        {% if link_enabled and link_text != blank %}
          <a
            href="{{ link_url }}"
            class="ai-mega-menu-link-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}"
            data-menu-index="{{ i }}"
          >
            {{ link_text }}
          </a>
        {% endif %}
      {% endfor %}
    </nav>

    <div class="ai-mega-menu-images-{{ ai_gen_id }}">
      {% for i in (1..6) %}
        {% liquid
          assign link_enabled_key = 'link_' | append: i | append: '_enabled'
          assign image_1_key = 'link_' | append: i | append: '_image_1'
          assign image_2_key = 'link_' | append: i | append: '_image_2'

          assign link_enabled = block.settings[link_enabled_key]
          assign image_1 = block.settings[image_1_key]
          assign image_2 = block.settings[image_2_key]
        %}

        {% if link_enabled %}
          <div
            class="ai-mega-menu-image-set-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}"
            data-image-set="{{ i }}"
          >
            <div class="ai-mega-menu-image-wrapper-{{ ai_gen_id }}">
              {% if image_1 %}
                <img
                  src="{{ image_1 | image_url: width: 800 }}"
                  alt="{{ image_1.alt | escape }}"
                  loading="lazy"
                  width="{{ image_1.width }}"
                  height="{{ image_1.height }}"
                >
              {% else %}
                <div class="ai-mega-menu-placeholder-{{ ai_gen_id }}">
                  {{ 'image' | placeholder_svg_tag }}
                </div>
              {% endif %}
            </div>

            <div class="ai-mega-menu-image-wrapper-{{ ai_gen_id }}">
              {% if image_2 %}
                <img
                  src="{{ image_2 | image_url: width: 800 }}"
                  alt="{{ image_2.alt | escape }}"
                  loading="lazy"
                  width="{{ image_2.width }}"
                  height="{{ image_2.height }}"
                >
              {% else %}
                <div class="ai-mega-menu-placeholder-{{ ai_gen_id }}">
                  {{ 'image' | placeholder_svg_tag }}
                </div>
              {% endif %}
            </div>
          </div>

          {% if image_1 == blank and image_2 == blank %}
            <div class="ai-mega-menu-empty-state-{{ ai_gen_id }}">
              Add images for this menu item
            </div>
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
</mega-menu-{{ ai_gen_id }}>

<script>
  (function() {
    class MegaMenu{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.links = this.querySelectorAll('.ai-mega-menu-link-{{ ai_gen_id }}');
        this.imageSets = this.querySelectorAll('.ai-mega-menu-image-set-{{ ai_gen_id }}');
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.links.forEach((link) => {
          link.addEventListener('mouseenter', () => {
            const menuIndex = link.getAttribute('data-menu-index');
            this.showImageSet(menuIndex);
            this.setActiveLink(link);
          });
        });
      }

      showImageSet(index) {
        this.imageSets.forEach((imageSet) => {
          const setIndex = imageSet.getAttribute('data-image-set');
          if (setIndex === index) {
            imageSet.classList.add('active');
          } else {
            imageSet.classList.remove('active');
          }
        });
      }

      setActiveLink(activeLink) {
        this.links.forEach((link) => {
          link.classList.remove('active');
        });
        activeLink.classList.add('active');
      }
    }

    customElements.define('mega-menu-{{ ai_gen_id }}', MegaMenu{{ ai_gen_id }});
  })();
</script>


