{%- liquid
  assign logo = section.settings.logo
  assign search_placeholder = section.settings.search_placeholder
-%}

<header
  class="custom-header"
  style="
    --ch-bg: {{ section.settings.background_color }};
    --ch-text: {{ section.settings.text_color }};
    --ch-border: {{ section.settings.border_color }};
  "
>
  <div class="custom-header__inner page-width">
    <!-- Search -->
    <div class="custom-header__search">
      <form action="/search" method="get" class="custom-header__search-form">
        <input
          type="search"
          name="q"
          class="custom-header__search-input"
          placeholder="{{ search_placeholder }}"
          autocomplete="off"
        >
        <button type="submit" class="custom-header__search-btn" aria-label="Search">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
      </form>
    </div>

    <!-- Logo -->
    <div class="custom-header__logo">
      <a href="/" class="custom-header__logo-link">
        {%- if logo != blank -%}
          {{ logo | image_url: width: 400 | image_tag: class: 'custom-header__logo-img', loading: 'eager', alt: shop.name }}
        {%- else -%}
          <span class="custom-header__logo-text">{{ shop.name }}</span>
        {%- endif -%}
      </a>
    </div>

    <!-- Icons -->
    <div class="custom-header__icons">
      {%- if section.settings.show_account and shop.customer_accounts_enabled -%}
        <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="custom-header__icon" aria-label="Account">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      {%- endif -%}

      {%- if section.settings.show_wishlist -%}
        <a href="{{ section.settings.wishlist_url | default: '/pages/wishlist' }}" class="custom-header__icon" aria-label="Wishlist">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </a>
      {%- endif -%}

      <a href="{{ routes.cart_url }}" class="custom-header__icon custom-header__cart" aria-label="Cart">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        <span class="custom-header__cart-count" data-cart-count>{{ cart.item_count }}</span>
      </a>
    </div>
  </div>
</header>

{% stylesheet %}
  .custom-header {
    background: var(--ch-bg);
    border-bottom: 1px solid var(--ch-border);
    padding: 12px 0;
  }

  .custom-header__inner {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 20px;
  }

  /* Search */
  .custom-header__search {
    justify-self: start;
  }

  .custom-header__search-form {
    display: flex;
    align-items: center;
    border: 1px solid #ddd;
    border-radius: 30px;
    overflow: hidden;
    background: #fff;
    width: 280px;
  }

  .custom-header__search-input {
    flex: 1;
    border: none;
    outline: none;
    padding: 10px 16px;
    font-size: 13px;
    color: #666;
    background: transparent;
  }

  .custom-header__search-input::placeholder {
    color: #aaa;
  }

  .custom-header__search-btn {
    background: none;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    color: #666;
    display: flex;
    align-items: center;
  }

  .custom-header__search-btn:hover {
    color: #000;
  }

  /* Logo */
  .custom-header__logo {
    justify-self: center;
    text-align: center;
  }

  .custom-header__logo-link {
    text-decoration: none;
    color: var(--ch-text);
  }

  .custom-header__logo-img {
    max-height: 50px;
    width: auto;
  }

  .custom-header__logo-text {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 0.05em;
    color: var(--ch-text);
  }

  /* Icons */
  .custom-header__icons {
    justify-self: end;
    display: flex;
    align-items: center;
    gap: 18px;
  }

  .custom-header__icon {
    color: var(--ch-text);
    text-decoration: none;
    display: flex;
    align-items: center;
    transition: opacity 0.2s ease;
  }

  .custom-header__icon:hover {
    opacity: 0.6;
  }

  .custom-header__cart {
    position: relative;
  }

  .custom-header__cart-count {
    position: absolute;
    top: -6px;
    right: -8px;
    background: #c41e3a;
    color: #fff;
    font-size: 10px;
    font-weight: 600;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  .custom-header__cart-count:empty {
    display: none;
  }

  /* Responsive */
  @media screen and (max-width: 749px) {
    .custom-header__inner {
      grid-template-columns: auto 1fr auto;
      gap: 12px;
    }

    .custom-header__search-form {
      width: 160px;
    }

    .custom-header__logo-img {
      max-height: 36px;
    }

    .custom-header__icons {
      gap: 14px;
    }
  }

  @media screen and (max-width: 480px) {
    .custom-header__search-form {
      width: 120px;
    }

    .custom-header__search-input {
      padding: 8px 12px;
      font-size: 12px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Custom Header",
  "tag": "section",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder",
      "default": "Search the shiny things..."
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show account icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_wishlist",
      "label": "Show wishlist icon",
      "default": true
    },
    {
      "type": "url",
      "id": "wishlist_url",
      "label": "Wishlist page URL"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text / Icon color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#EEEEEE"
    }
  ],
  "presets": [
    {
      "name": "Custom Header",
      "category": "Header"
    }
  ]
}
{% endschema %}
